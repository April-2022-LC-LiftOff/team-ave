/*
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
import { Component, Input } from '@angular/core';
import { merge, partition, timer } from 'rxjs';
import { debounce, distinctUntilChanged, switchMap, tap } from 'rxjs/operators';
import { Spinkit } from '../spinkits';
import * as i0 from "@angular/core";
import * as i1 from "../services/pending-requests-interceptor.service";
import * as i2 from "../services/spinner-visibility.service";
import * as i3 from "@angular/common";
import * as i4 from "./sk-cube-grid/sk-cube-grid.component";
import * as i5 from "./sk-chasing-dots/sk-chasing-dots.component";
import * as i6 from "./sk-double-bounce/sk-double-bounce.component";
import * as i7 from "./sk-rotating-plane/sk-rotating-plane.component";
import * as i8 from "./sk-spinner-pulse/sk-spinner-pulse.component";
import * as i9 from "./sk-three-bounce/sk-three-bounce.component";
import * as i10 from "./sk-wandering-cubes/sk-wandering-cubes.component";
import * as i11 from "./sk-wave/sk-wave.component";
export class NgHttpLoaderComponent {
    constructor(pendingRequestsInterceptor, spinnerVisibility) {
        this.pendingRequestsInterceptor = pendingRequestsInterceptor;
        this.spinnerVisibility = spinnerVisibility;
        this.spinkit = Spinkit;
        this.visibleUntil = Date.now();
        this.backdrop = true;
        this.debounceDelay = 0;
        this.entryComponent = null;
        this.extraDuration = 0;
        this.filteredHeaders = [];
        this.filteredMethods = [];
        this.filteredUrlPatterns = [];
        this.minDuration = 0;
        this.opacity = '.7';
        this.backdropBackgroundColor = '#f1f1f1';
        this.spinner = Spinkit.skWave;
    }
    ngOnInit() {
        this.initIsvisibleObservable();
        this.nullifySpinnerIfEntryComponentIsDefined();
        this.initFilters();
    }
    initIsvisibleObservable() {
        const [showSpinner$, hideSpinner$] = partition(this.pendingRequestsInterceptor.pendingRequestsStatus$, h => h);
        this.isVisible$ = merge(this.pendingRequestsInterceptor.pendingRequestsStatus$
            .pipe(switchMap(() => showSpinner$.pipe(debounce(() => timer(this.debounceDelay))))), showSpinner$
            .pipe(switchMap(() => hideSpinner$.pipe(debounce(() => this.getVisibilityTimer$())))), this.spinnerVisibility.visibility$).pipe(distinctUntilChanged(), tap(h => this.updateExpirationDelay(h)));
    }
    nullifySpinnerIfEntryComponentIsDefined() {
        if (this.entryComponent) {
            this.spinner = null;
        }
    }
    initFilters() {
        this.initFilteredUrlPatterns();
        this.initFilteredMethods();
        this.initFilteredHeaders();
    }
    initFilteredUrlPatterns() {
        if (!!this.filteredUrlPatterns.length) {
            this.filteredUrlPatterns.forEach(e => this.pendingRequestsInterceptor.filteredUrlPatterns.push(new RegExp(e)));
        }
    }
    initFilteredMethods() {
        this.pendingRequestsInterceptor.filteredMethods = this.filteredMethods;
    }
    initFilteredHeaders() {
        this.pendingRequestsInterceptor.filteredHeaders = this.filteredHeaders;
    }
    updateExpirationDelay(showSpinner) {
        if (showSpinner) {
            this.visibleUntil = Date.now() + this.minDuration;
        }
    }
    getVisibilityTimer$() {
        return timer(Math.max(this.extraDuration, this.visibleUntil - Date.now()));
    }
}
NgHttpLoaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.0", ngImport: i0, type: NgHttpLoaderComponent, deps: [{ token: i1.PendingRequestsInterceptor }, { token: i2.SpinnerVisibilityService }], target: i0.ɵɵFactoryTarget.Component });
NgHttpLoaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.0.0", type: NgHttpLoaderComponent, selector: "ng-http-loader", inputs: { backdrop: "backdrop", backgroundColor: "backgroundColor", debounceDelay: "debounceDelay", entryComponent: "entryComponent", extraDuration: "extraDuration", filteredHeaders: "filteredHeaders", filteredMethods: "filteredMethods", filteredUrlPatterns: "filteredUrlPatterns", minDuration: "minDuration", opacity: "opacity", backdropBackgroundColor: "backdropBackgroundColor", spinner: "spinner" }, ngImport: i0, template: "<div id=\"spinner\"\n     *ngIf=\"isVisible$ | async\"\n     [class.backdrop]=\"backdrop\"\n     [style.opacity]=\"opacity\"\n     [ngStyle]=\"{'background-color': backdrop ? backdropBackgroundColor : 'transparent'}\">\n\n    <ng-container *ngComponentOutlet=\"entryComponent\"></ng-container>\n\n    <sk-cube-grid\n        *ngIf=\"spinner === spinkit.skCubeGrid\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-cube-grid>\n\n    <sk-chasing-dots\n        *ngIf=\"spinner === spinkit.skChasingDots\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-chasing-dots>\n\n    <sk-double-bounce\n        *ngIf=\"spinner === spinkit.skDoubleBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-double-bounce>\n\n    <sk-rotating-plane\n        *ngIf=\"spinner === spinkit.skRotatingPlane\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-rotating-plane>\n\n    <sk-spinner-pulse\n        *ngIf=\"spinner === spinkit.skSpinnerPulse\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-spinner-pulse>\n\n    <sk-three-bounce\n        *ngIf=\"spinner === spinkit.skThreeBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-three-bounce>\n\n    <sk-wandering-cubes\n        *ngIf=\"spinner === spinkit.skWanderingCubes\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wandering-cubes>\n\n    <sk-wave\n        *ngIf=\"spinner === spinkit.skWave\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wave>\n\n</div>\n\n", styles: ["#spinner{top:50%;left:50%;transform:translate(-50%,-50%);position:fixed;z-index:9999}#spinner.backdrop{top:0;left:0;height:100%;width:100%;display:flex;align-items:center;justify-content:center;transform:none}::ng-deep .colored-parent,::ng-deep .colored>div{background-color:#333}\n"], dependencies: [{ kind: "directive", type: i3.NgComponentOutlet, selector: "[ngComponentOutlet]", inputs: ["ngComponentOutlet", "ngComponentOutletInjector", "ngComponentOutletContent", "ngComponentOutletNgModule", "ngComponentOutletNgModuleFactory"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: i4.SkCubeGridComponent, selector: "sk-cube-grid" }, { kind: "component", type: i5.SkChasingDotsComponent, selector: "sk-chasing-dots" }, { kind: "component", type: i6.SkDoubleBounceComponent, selector: "sk-double-bounce" }, { kind: "component", type: i7.SkRotatingPlaneComponent, selector: "sk-rotating-plane" }, { kind: "component", type: i8.SkSpinnerPulseComponent, selector: "sk-spinner-pulse" }, { kind: "component", type: i9.SkThreeBounceComponent, selector: "sk-three-bounce" }, { kind: "component", type: i10.SkWanderingCubesComponent, selector: "sk-wandering-cubes" }, { kind: "component", type: i11.SkWaveComponent, selector: "sk-wave" }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.0", ngImport: i0, type: NgHttpLoaderComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ng-http-loader', template: "<div id=\"spinner\"\n     *ngIf=\"isVisible$ | async\"\n     [class.backdrop]=\"backdrop\"\n     [style.opacity]=\"opacity\"\n     [ngStyle]=\"{'background-color': backdrop ? backdropBackgroundColor : 'transparent'}\">\n\n    <ng-container *ngComponentOutlet=\"entryComponent\"></ng-container>\n\n    <sk-cube-grid\n        *ngIf=\"spinner === spinkit.skCubeGrid\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-cube-grid>\n\n    <sk-chasing-dots\n        *ngIf=\"spinner === spinkit.skChasingDots\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-chasing-dots>\n\n    <sk-double-bounce\n        *ngIf=\"spinner === spinkit.skDoubleBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-double-bounce>\n\n    <sk-rotating-plane\n        *ngIf=\"spinner === spinkit.skRotatingPlane\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-rotating-plane>\n\n    <sk-spinner-pulse\n        *ngIf=\"spinner === spinkit.skSpinnerPulse\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-spinner-pulse>\n\n    <sk-three-bounce\n        *ngIf=\"spinner === spinkit.skThreeBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-three-bounce>\n\n    <sk-wandering-cubes\n        *ngIf=\"spinner === spinkit.skWanderingCubes\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wandering-cubes>\n\n    <sk-wave\n        *ngIf=\"spinner === spinkit.skWave\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wave>\n\n</div>\n\n", styles: ["#spinner{top:50%;left:50%;transform:translate(-50%,-50%);position:fixed;z-index:9999}#spinner.backdrop{top:0;left:0;height:100%;width:100%;display:flex;align-items:center;justify-content:center;transform:none}::ng-deep .colored-parent,::ng-deep .colored>div{background-color:#333}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.PendingRequestsInterceptor }, { type: i2.SpinnerVisibilityService }]; }, propDecorators: { backdrop: [{
                type: Input
            }], backgroundColor: [{
                type: Input
            }], debounceDelay: [{
                type: Input
            }], entryComponent: [{
                type: Input
            }], extraDuration: [{
                type: Input
            }], filteredHeaders: [{
                type: Input
            }], filteredMethods: [{
                type: Input
            }], filteredUrlPatterns: [{
                type: Input
            }], minDuration: [{
                type: Input
            }], opacity: [{
                type: Input
            }], backdropBackgroundColor: [{
                type: Input
            }], spinner: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaHR0cC1sb2FkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL25nLWh0dHAtbG9hZGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9uZy1odHRwLWxvYWRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztHQU9HO0FBRUgsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssRUFBYyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR2hGLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7Ozs7Ozs7QUFPdEMsTUFBTSxPQUFPLHFCQUFxQjtJQW1COUIsWUFBb0IsMEJBQXNELEVBQVUsaUJBQTJDO1FBQTNHLCtCQUEwQixHQUExQiwwQkFBMEIsQ0FBNEI7UUFBVSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQTBCO1FBakIvSCxZQUFPLEdBQUcsT0FBTyxDQUFDO1FBRWxCLGlCQUFZLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRWpCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFFaEIsa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFDbEIsbUJBQWMsR0FBUSxJQUFJLENBQUM7UUFDM0Isa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFDbEIsb0JBQWUsR0FBYSxFQUFFLENBQUM7UUFDL0Isb0JBQWUsR0FBYSxFQUFFLENBQUM7UUFDL0Isd0JBQW1CLEdBQWEsRUFBRSxDQUFDO1FBQ25DLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLFlBQU8sR0FBRyxJ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QUFoQixLQUFLO2dCQUNHLGVBQWU7c0JBQXZCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csZUFBZTtzQkFBdkIsS0FBSztnQkFDRyxlQUFlO3NCQUF2QixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLE9BQU87c0JBQWYsS0FBSztnQkFDRyx1QkFBdUI7c0JBQS9CLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTXG4gKiBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1JcbiAqIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUlxuICogSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU5cbiAqIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBtZXJnZSwgT2JzZXJ2YWJsZSwgcGFydGl0aW9uLCB0aW1lciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2UsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFBlbmRpbmdSZXF1ZXN0c0ludGVyY2VwdG9yIH0gZnJvbSAnLi4vc2VydmljZXMvcGVuZGluZy1yZXF1ZXN0cy1pbnRlcmNlcHRvci5zZXJ2aWNlJztcbmltcG9ydCB7IFNwaW5uZXJWaXNpYmlsaXR5U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NwaW5uZXItdmlzaWJpbGl0eS5zZXJ2aWNlJztcbmltcG9ydCB7IFNwaW5raXQgfSBmcm9tICcuLi9zcGlua2l0cyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbmctaHR0cC1sb2FkZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9uZy1odHRwLWxvYWRlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbmctaHR0cC1sb2FkZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ0h0dHBMb2FkZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgc3BpbmtpdCA9IFNwaW5raXQ7XG4gICAgaXNWaXNpYmxlJCE6IE9ic2VydmFibGU8Ym9vbGVhbj47XG4gICAgdmlzaWJsZVVudGlsID0gRGF0ZS5ub3coKTtcblxuICAgIEBJbnB1dCgpIGJhY2tkcm9wID0gdHJ1ZTtcbiAgICBASW5wdXQoKSBiYWNrZ3JvdW5kQ29sb3IhOiBzdHJpbmc7XG4gICAgQElucHV0KCkgZGVib3VuY2VEZWxheSA9IDA7XG4gICAgQElucHV0KCkgZW50cnlDb21wb25lbnQ6IGFueSA9IG51bGw7XG4gICAgQElucHV0KCkgZXh0cmFEdXJhdGlvbiA9IDA7XG4gICAgQElucHV0KCkgZmlsdGVyZWRIZWFkZXJzOiBzdHJpbmdbXSA9IFtdO1xuICAgIEBJbnB1dCgpIGZpbHRlcmVkTWV0aG9kczogc3RyaW5nW10gPSBbXTtcbiAgICBASW5wdXQoKSBmaWx0ZXJlZFVybFBhdHRlcm5zOiBzdHJpbmdbXSA9IFtdO1xuICAgIEBJbnB1dCgpIG1pbkR1cmF0aW9uID0gMDtcbiAgICBASW5wdXQoKSBvcGFjaXR5ID0gJy43JztcbiAgICBASW5wdXQoKSBiYWNrZHJvcEJhY2tncm91bmRDb2xvciA9ICcjZjFmMWYxJztcbiAgICBASW5wdXQoKSBzcGlubmVyOiBzdHJpbmcgfCBudWxsID0gU3BpbmtpdC5za1dhdmU7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBlbmRpbmdSZXF1ZXN0c0ludGVyY2VwdG9yOiBQZW5kaW5nUmVxdWVzdHNJbnRlcmNlcHRvciwgcHJpdmF0ZSBzcGlubmVyVmlzaWJpbGl0eTogU3Bpbm5lclZpc2liaWxpdHlTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdElzdmlzaWJsZU9ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5udWxsaWZ5U3Bpbm5lcklmRW50cnlDb21wb25lbnRJc0RlZmluZWQoKTtcbiAgICAgICAgdGhpcy5pbml0RmlsdGVycygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdElzdmlzaWJsZU9ic2VydmFibGUoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IFtzaG93U3Bpbm5lciQsIGhpZGVTcGlubmVyJF0gPSBwYXJ0aXRpb24odGhpcy5wZW5kaW5nUmVxdWVzdHNJbnRlcmNlcHRvci5wZW5kaW5nUmVxdWVzdHNTdGF0dXMkLCBoID0+IGgpO1xuXG4gICAgICAgIHRoaXMuaXNWaXNpYmxlJCA9IG1lcmdlKFxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nUmVxdWVzdHNJbnRlcmNlcHRvci5wZW5kaW5nUmVxdWVzdHNTdGF0dXMkXG4gICAgICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKCgpID0+IHNob3dTcGlubmVyJC5waXBlKGRlYm91bmNlKCgpID0+IHRpbWVyKHRoaXMuZGVib3VuY2VEZWxheSkpKSkpLFxuICAgICAgICAgICAgc2hvd1NwaW5uZXIkXG4gICAgICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKCgpID0+IGhpZGVTcGlubmVyJC5waXBlKGRlYm91bmNlKCgpID0+IHRoaXMuZ2V0VmlzaWJpbGl0eVRpbWVyJCgpKSkpKSxcbiAgICAgICAgICAgIHRoaXMuc3Bpbm5lclZpc2liaWxpdHkudmlzaWJpbGl0eSRcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgICAgIHRhcChoID0+IHRoaXMudXBkYXRlRXhwaXJhdGlvbkRlbGF5KGgpKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgbnVsbGlmeVNwaW5uZXJJZkVudHJ5Q29tcG9uZW50SXNEZWZpbmVkKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5lbnRyeUNvbXBvbmVudCkge1xuICAgICAgICAgICAgdGhpcy5zcGlubmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdEZpbHRlcnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdEZpbHRlcmVkVXJsUGF0dGVybnMoKTtcbiAgICAgICAgdGhpcy5pbml0RmlsdGVyZWRNZXRob2RzKCk7XG4gICAgICAgIHRoaXMuaW5pdEZpbHRlcmVkSGVhZGVycygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdEZpbHRlcmVkVXJsUGF0dGVybnMoKTogdm9pZCB7XG4gICAgICAgIGlmICghIXRoaXMuZmlsdGVyZWRVcmxQYXR0ZXJucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRVcmxQYXR0ZXJucy5mb3JFYWNoKGUgPT5cbiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdSZXF1ZXN0c0ludGVyY2VwdG9yLmZpbHRlcmVkVXJsUGF0dGVybnMucHVzaChuZXcgUmVnRXhwKGUpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdEZpbHRlcmVkTWV0aG9kcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wZW5kaW5nUmVxdWVzdHNJbnRlcmNlcHRvci5maWx0ZXJlZE1ldGhvZHMgPSB0aGlzLmZpbHRlcmVkTWV0aG9kcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRGaWx0ZXJlZEhlYWRlcnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucGVuZGluZ1JlcXVlc3RzSW50ZXJjZXB0b3IuZmlsdGVyZWRIZWFkZXJzID0gdGhpcy5maWx0ZXJlZEhlYWRlcnM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVFeHBpcmF0aW9uRGVsYXkoc2hvd1NwaW5uZXI6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgaWYgKHNob3dTcGlubmVyKSB7XG4gICAgICAgICAgICB0aGlzLnZpc2libGVVbnRpbCA9IERhdGUubm93KCkgKyB0aGlzLm1pbkR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRWaXNpYmlsaXR5VGltZXIkKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgICAgIHJldHVybiB0aW1lcihNYXRoLm1heCh0aGlzLmV4dHJhRHVyYXRpb24sIHRoaXMudmlzaWJsZVVudGlsIC0gRGF0ZS5ub3coKSkpO1xuICAgIH1cbn1cbiIsIjxkaXYgaWQ9XCJzcGlubmVyXCJcbiAgICAgKm5nSWY9XCJpc1Zpc2libGUkIHwgYXN5bmNcIlxuICAgICBbY2xhc3MuYmFja2Ryb3BdPVwiYmFja2Ryb3BcIlxuICAgICBbc3R5bGUub3BhY2l0eV09XCJvcGFjaXR5XCJcbiAgICAgW25nU3R5bGVdPVwieydiYWNrZ3JvdW5kLWNvbG9yJzogYmFja2Ryb3AgPyBiYWNrZHJvcEJhY2tncm91bmRDb2xvciA6ICd0cmFuc3BhcmVudCd9XCI+XG5cbiAgICA8bmctY29udGFpbmVyICpuZ0NvbXBvbmVudE91dGxldD1cImVudHJ5Q29tcG9uZW50XCI+PC9uZy1jb250YWluZXI+XG5cbiAgICA8c2stY3ViZS1ncmlkXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gc3BpbmtpdC5za0N1YmVHcmlkXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLWN1YmUtZ3JpZD5cblxuICAgIDxzay1jaGFzaW5nLWRvdHNcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrQ2hhc2luZ0RvdHNcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2stY2hhc2luZy1kb3RzPlxuXG4gICAgPHNrLWRvdWJsZS1ib3VuY2VcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrRG91YmxlQm91bmNlXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLWRvdWJsZS1ib3VuY2U+XG5cbiAgICA8c2stcm90YXRpbmctcGxhbmVcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrUm90YXRpbmdQbGFuZVwiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay1yb3RhdGluZy1wbGFuZT5cblxuICAgIDxzay1zcGlubmVyLXB1bHNlXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gc3BpbmtpdC5za1NwaW5uZXJQdWxzZVwiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay1zcGlubmVyLXB1bHNlPlxuXG4gICAgPHNrLXRocmVlLWJvdW5jZVxuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IHNwaW5raXQuc2tUaHJlZUJvdW5jZVwiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay10aHJlZS1ib3VuY2U+XG5cbiAgICA8c2std2FuZGVyaW5nLWN1YmVzXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gc3BpbmtpdC5za1dhbmRlcmluZ0N1YmVzXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXdhbmRlcmluZy1jdWJlcz5cblxuICAgIDxzay13YXZlXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gc3BpbmtpdC5za1dhdmVcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2std2F2ZT5cblxuPC9kaXY+XG5cbiJdfQ==